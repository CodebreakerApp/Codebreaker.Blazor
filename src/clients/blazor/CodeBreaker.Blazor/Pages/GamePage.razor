@page "/game"
@using CodeBreaker.Blazor.Components

<h2>Game</h2>

<PageMessages PageMessageService="_pageMessageService" />

@if (GameStatus == GameMode.NotRunning)
{
    <div class="d-flex start-game-container">
        <MudTextField @bind-Value="Name" Label="Enter your gamername" Variant="Variant.Text" Required="true" RequiredError="The name is required" MaxLength="100" />
        <MudButton Disabled="@(String.IsNullOrWhiteSpace(Name))" Variant="Variant.Filled" OnClick="async () => await StartGameAsync()">
            @if (InProgress)
            {
                <div class="button-slot-start">
                    <MudProgressCircular Size="Size.Small" Indeterminate="true" />
                </div>
            }
            Start the game
        </MudButton>
    </div>
}
else if (GameStatus is GameMode.Started or GameMode.MoveSet)
{
    <div class="container">
        <div class="game-container">
            @for (int i = OpenMoves; i > 0; i--)
            {
                <div class="@(i == 1 ? "game-row selectable": "game-row")">
                    <div class="move-number">@i</div>
                    <div class="@(i == 1 ? _currentMove[0].Item2 : "")" @onclick="() => SelectField(0)"></div>
                    <div class="@(i == 1 ? _currentMove[1].Item2 : "")" @onclick="() => SelectField(1)"></div>
                    <div class="@(i == 1 ? _currentMove[2].Item2 : "")" @onclick="() => SelectField(2)"></div>
                    <div class="@(i == 1 ? _currentMove[3].Item2 : "")" @onclick="() => SelectField(3)"></div>
                    @if (i == 1)
                    {
                        <div>
                            <MudIconButton Variant="Variant.Outlined"
                               Color="Color.Primary"
                               Icon="@Icons.Filled.PlayCircle"
                               OnClick="async () => await SetMoveAsync()"></MudIconButton>
                        </div>
                    }
                    else
                    {
                        <div class="key-pegs"></div>
                    }
                </div>
            }
            @foreach (var move in GameMoves.Reverse())
            {
                <div class="game-move">
                    <div class="move-number">1</div>
                    @foreach (var guess in move.GuessPegs)
                    {

                        <div class="@(guess.ToLower())"></div>
                    }
                    <div class="key-pegs">
                        @for (int y = 0; y < move.KeyPegs.Black; y++)
                        {
                            <div class="black">
                            </div>
                        }
                        @for (int y = 0; y < move.KeyPegs.White; y++)
                        {
                            <div class="white">
                            </div>
                        }
                    </div>
                </div>
            }
        </div>
        <div class="colors">
            @foreach (string colorField in Game?.Type.Fields ?? Array.Empty<string>())
            {
                <div class="@(_selectable ? $"{colorField.ToLower()} selectable": colorField.ToLower())"
             @onclick="() => SelectColor(colorField)">
                    @colorField[0]
                </div>
            }
        </div>
    </div>
}
